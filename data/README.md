# 数据收集指南

本文档介绍如何收集和准备训练数据。

## 数据来源

### 1. 社区谱面
- 从 maimai 社区收集公开的 simai 格式谱面
- 确保收集的谱面质量较高（推荐从知名谱师处获取）

### 2. 官方谱面转换
- 如果有官方谱面的数据，需要先转换为 simai 格式

## 目录结构

```
data/
├── raw/                 # 原始谱面文件
│   ├── song1.txt       # simai 格式谱面
│   ├── song2.txt
│   └── ...
├── audio/              # 对应的音频文件
│   ├── song1.mp3      # 必须与谱面同名
│   ├── song2.mp3
│   └── ...
└── processed/          # 预处理后的数据（自动生成）
```

## 文件命名规则

**重要**: 谱面文件名必须与音频文件名一致（不含扩展名）

例如:
- 谱面: `Oshama_Scramble.txt`
- 音频: `Oshama_Scramble.mp3`

## 谱面格式要求

谱面应该是标准的 simai 格式，包含以下内容:

```
&title=曲名
&wholebpm=BPM
&first=偏移时间
&lv_5=难度等级
&des_5=谱师
&inote_5=
(BPM){分音符}
谱面数据...
E
```

## 数据质量检查

在预处理前，建议检查:

1. **谱面语法正确性**: 确保谱面可以在 MajdataView 中正常播放
2. **音频-谱面对齐**: 确保 `&first` 偏移设置正确
3. **BPM 正确性**: 确保 `&wholebpm` 设置正确

## 推荐数据量

- **最小**: 50-100 首曲目
- **建议**: 500+ 首曲目
- **理想**: 1000+ 首曲目

## 数据平衡

建议收集不同类型的谱面:

- 不同 BPM 范围 (100-200+)
- 不同难度 (9-15)
- 不同风格 (流行、电子、古典等)
- 不同谱师风格

## 预处理

准备好数据后，运行:

```bash
python -m src.data.preprocess --raw-dir data/raw --audio-dir data/audio --output-dir data/processed
```

这会:
1. 解析所有谱面
2. 提取音频特征
3. 构建音频-谱面对齐
4. 保存为训练格式
